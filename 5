-- WA Universal ESP v1.0 (PURE ESP - NO AIMBOT)
-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- Load Fluent
local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()

-- Drawing Cache
local ESP_Cache = {}

-- Configuration
local Config = {
    Enabled = false,
    BoxESP = false,
    NameESP = false,
    HealthESP = false,
    TracerESP = false,
    TeamCheck = false,
    BoxStyle = "Corner",
    TracerOrigin = "Bottom",
    HealthStyle = "Bar",
    BoxThickness = 1,
    TextSize = 14,
    MaxDistance = 1000,
    EnemyColor = Color3.fromRGB(255, 25, 25),
    AllyColor = Color3.fromRGB(25, 255, 25),
}

-- Colors
local Colors = {
    Enemy = Config.EnemyColor,
    Ally = Config.AllyColor,
}

-- Create Window
local Window = Fluent:CreateWindow({
    Title = "WA ESP v1.0",
    SubTitle = "Pure ESP",
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 460),
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.LeftControl
})

-- Create Tabs
local Tabs = {
    Main = Window:AddTab({ Title = "Main", Icon = "home" }),
    ESP = Window:AddTab({ Title = "ESP", Icon = "eye" }),
}

-- Main Tab
do
    local Section = Tabs.Main:AddSection("Main Controls")
    
    local Toggle = Section:AddToggle("Enabled", {
        Title = "Enable ESP",
        Default = Config.Enabled
    })
    Toggle:OnChanged(function(Value)
        Config.Enabled = Value
    end)
    
    local Toggle2 = Section:AddToggle("TeamCheck", {
        Title = "Team Check",
        Default = Config.TeamCheck
    })
    Toggle2:OnChanged(function(Value)
        Config.TeamCheck = Value
    end)
    
    local Slider = Section:AddSlider("MaxDistance", {
        Title = "Max Distance",
        Default = Config.MaxDistance,
        Min = 100,
        Max = 5000,
        Rounding = 0
    })
    Slider:OnChanged(function(Value)
        Config.MaxDistance = Value
    end)
end

-- ESP Tab
do
    local BoxSection = Tabs.ESP:AddSection("Box ESP")
    
    local BoxToggle = BoxSection:AddToggle("BoxESP", {
        Title = "Box ESP",
        Default = Config.BoxESP
    })
    BoxToggle:OnChanged(function(Value)
        Config.BoxESP = Value
    end)
    
    local BoxStyle = BoxSection:AddDropdown("BoxStyle", {
        Title = "Box Style",
        Values = {"Corner", "Full"},
        Default = Config.BoxStyle
    })
    BoxStyle:OnChanged(function(Value)
        Config.BoxStyle = Value
    end)
    
    local BoxThick = BoxSection:AddSlider("BoxThickness", {
        Title = "Box Thickness",
        Default = Config.BoxThickness,
        Min = 1,
        Max = 5,
        Rounding = 1
    })
    BoxThick:OnChanged(function(Value)
        Config.BoxThickness = Value
    end)
    
    local NameSection = Tabs.ESP:AddSection("Name ESP")
    
    local NameToggle = NameSection:AddToggle("NameESP", {
        Title = "Name ESP",
        Default = Config.NameESP
    })
    NameToggle:OnChanged(function(Value)
        Config.NameESP = Value
    end)
    
    local TextSlider = NameSection:AddSlider("TextSize", {
        Title = "Text Size",
        Default = Config.TextSize,
        Min = 10,
        Max = 24,
        Rounding = 0
    })
    TextSlider:OnChanged(function(Value)
        Config.TextSize = Value
    end)
    
    local HealthSection = Tabs.ESP:AddSection("Health ESP")
    
    local HealthToggle = HealthSection:AddToggle("HealthESP", {
        Title = "Health ESP",
        Default = Config.HealthESP
    })
    HealthToggle:OnChanged(function(Value)
        Config.HealthESP = Value
    end)
    
    local HealthStyle = HealthSection:AddDropdown("HealthStyle", {
        Title = "Health Style",
        Values = {"Bar", "Text", "Both"},
        Default = Config.HealthStyle
    })
    HealthStyle:OnChanged(function(Value)
        Config.HealthStyle = Value
    end)
    
    local TracerSection = Tabs.ESP:AddSection("Tracers")
    
    local TracerToggle = TracerSection:AddToggle("TracerESP", {
        Title = "Tracer ESP",
        Default = Config.TracerESP
    })
    TracerToggle:OnChanged(function(Value)
        Config.TracerESP = Value
    end)
    
    local TracerOrigin = TracerSection:AddDropdown("TracerOrigin", {
        Title = "Tracer Origin",
        Values = {"Bottom", "Top", "Mouse", "Center"},
        Default = Config.TracerOrigin
    })
    TracerOrigin:OnChanged(function(Value)
        Config.TracerOrigin = Value
    end)
    
    local ColorSection = Tabs.ESP:AddSection("Colors")
    
    local EnemyColor = ColorSection:AddColorpicker("EnemyColor", {
        Title = "Enemy Color",
        Default = Config.EnemyColor
    })
    EnemyColor:OnChanged(function(Value)
        Config.EnemyColor = Value
        Colors.Enemy = Value
    end)
    
    local AllyColor = ColorSection:AddColorpicker("AllyColor", {
        Title = "Ally Color",
        Default = Config.AllyColor
    })
    AllyColor:OnChanged(function(Value)
        Config.AllyColor = Value
        Colors.Ally = Value
    end)
end

-- ESP Functions
local function GetPlayerColor(player)
    return (Config.TeamCheck and player.Team == LocalPlayer.Team) and Colors.Ally or Colors.Enemy
end

local function GetTracerOrigin()
    if Config.TracerOrigin == "Bottom" then
        return Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y)
    elseif Config.TracerOrigin == "Top" then
        return Vector2.new(Camera.ViewportSize.X/2, 0)
    elseif Config.TracerOrigin == "Mouse" then
        return UserInputService:GetMouseLocation()
    else
        return Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
    end
end

local function CreateESP(player)
    if player == LocalPlayer then return end
    
    local objects = {
        Box = {
            Top = Drawing.new("Line"),
            Bottom = Drawing.new("Line"),
            Left = Drawing.new("Line"),
            Right = Drawing.new("Line"),
            TopLeft = Drawing.new("Line"),
            TopRight = Drawing.new("Line"),
            BottomLeft = Drawing.new("Line"),
            BottomRight = Drawing.new("Line")
        },
        Name = Drawing.new("Text"),
        Tracer = Drawing.new("Line"),
        HealthBar = {
            Outline = Drawing.new("Square"),
            Fill = Drawing.new("Square"),
            Text = Drawing.new("Text")
        },
    }
    
    for _, line in pairs(objects.Box) do
        line.Visible = false
        line.Color = Colors.Enemy
        line.Thickness = Config.BoxThickness
    end
    
    objects.Name.Visible = false
    objects.Name.Center = true
    objects.Name.Outline = true
    objects.Name.Size = Config.TextSize
    objects.Name.Color = Colors.Enemy
    objects.Name.Font = 2
    
    objects.Tracer.Visible = false
    objects.Tracer.Color = Colors.Enemy
    objects.Tracer.Thickness = 1
    
    objects.HealthBar.Outline.Visible = false
    objects.HealthBar.Outline.Filled = false
    objects.HealthBar.Outline.Color = Color3.new(0, 0, 0)
    objects.HealthBar.Outline.Thickness = 1
    
    objects.HealthBar.Fill.Visible = false
    objects.HealthBar.Fill.Filled = true
    objects.HealthBar.Fill.Color = Color3.fromRGB(0, 255, 0)
    
    objects.HealthBar.Text.Visible = false
    objects.HealthBar.Text.Center = true
    objects.HealthBar.Text.Size = Config.TextSize
    objects.HealthBar.Text.Font = 2
    
    ESP_Cache[player] = objects
end

local function RemoveESP(player)
    if ESP_Cache[player] then
        for _, obj in pairs(ESP_Cache[player]) do
            if type(obj) == "table" then
                for _, subObj in pairs(obj) do
                    pcall(function() subObj:Remove() end)
                end
            else
                pcall(function() obj:Remove() end)
            end
        end
        ESP_Cache[player] = nil
    end
end

local function UpdateESP(player)
    if not Config.Enabled then return end
    
    local objects = ESP_Cache[player]
    if not objects then
        CreateESP(player)
        objects = ESP_Cache[player]
    end
    if not objects then return end
    
    local character = player.Character
    if not character then
        for _, line in pairs(objects.Box) do line.Visible = false end
        objects.Name.Visible = false
        objects.Tracer.Visible = false
        objects.HealthBar.Outline.Visible = false
        objects.HealthBar.Fill.Visible = false
        objects.HealthBar.Text.Visible = false
        return
    end
    
    local rootPart = character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("Torso")
    local humanoid = character:FindFirstChild("Humanoid")
    
    if not rootPart or not humanoid or humanoid.Health <= 0 then
        for _, line in pairs(objects.Box) do line.Visible = false end
        objects.Name.Visible = false
        objects.Tracer.Visible = false
        objects.HealthBar.Outline.Visible = false
        objects.HealthBar.Fill.Visible = false
        objects.HealthBar.Text.Visible = false
        return
    end
    
    local pos, onScreen = Camera:WorldToViewportPoint(rootPart.Position)
    local distance = (rootPart.Position - Camera.CFrame.Position).Magnitude
    
    if not onScreen or distance > Config.MaxDistance then
        for _, line in pairs(objects.Box) do line.Visible = false end
        objects.Name.Visible = false
        objects.Tracer.Visible = false
        objects.HealthBar.Outline.Visible = false
        objects.HealthBar.Fill.Visible = false
        objects.HealthBar.Text.Visible = false
        return
    end
    
    local isTeam = Config.TeamCheck and player.Team == LocalPlayer.Team
    if isTeam then
        for _, line in pairs(objects.Box) do line.Visible = false end
        objects.Name.Visible = false
        objects.Tracer.Visible = false
        objects.HealthBar.Outline.Visible = false
        objects.HealthBar.Fill.Visible = false
        objects.HealthBar.Text.Visible = false
        return
    end
    
    local color = GetPlayerColor(player)
    
    -- Box calculations
    local size = character:GetExtentsSize()
    local cf = rootPart.CFrame
    local top = Camera:WorldToViewportPoint(cf * CFrame.new(0, size.Y/2, 0).Position)
    local bottom = Camera:WorldToViewportPoint(cf * CFrame.new(0, -size.Y/2, 0).Position)
    
    local screenHeight = math.abs(bottom.Y - top.Y)
    local boxWidth = screenHeight * 0.65
    local boxPos = Vector2.new(top.X - boxWidth/2, top.Y)
    local boxSize = Vector2.new(boxWidth, screenHeight)
    
    -- Box ESP
    if Config.BoxESP then
        for _, line in pairs(objects.Box) do line.Visible = false end
        
        if Config.BoxStyle == "Full" then
            objects.Box.Left.From = boxPos
            objects.Box.Left.To = boxPos + Vector2.new(0, boxSize.Y)
            objects.Box.Left.Visible = true
            
            objects.Box.Right.From = boxPos + Vector2.new(boxSize.X, 0)
            objects.Box.Right.To = boxPos + Vector2.new(boxSize.X, boxSize.Y)
            objects.Box.Right.Visible = true
            
            objects.Box.Top.From = boxPos
            objects.Box.Top.To = boxPos + Vector2.new(boxSize.X, 0)
            objects.Box.Top.Visible = true
            
            objects.Box.Bottom.From = boxPos + Vector2.new(0, boxSize.Y)
            objects.Box.Bottom.To = boxPos + Vector2.new(boxSize.X, boxSize.Y)
            objects.Box.Bottom.Visible = true
        else
            local cornerSize = math.min(boxWidth * 0.2, 20)
            
            objects.Box.TopLeft.From = boxPos
            objects.Box.TopLeft.To = boxPos + Vector2.new(cornerSize, 0)
            objects.Box.TopLeft.Visible = true
            
            objects.Box.Left.From = boxPos
            objects.Box.Left.To = boxPos + Vector2.new(0, cornerSize)
            objects.Box.Left.Visible = true
            
            objects.Box.TopRight.From = boxPos + Vector2.new(boxSize.X, 0)
            objects.Box.TopRight.To = boxPos + Vector2.new(boxSize.X - cornerSize, 0)
            objects.Box.TopRight.Visible = true
            
            objects.Box.Right.From = boxPos + Vector2.new(boxSize.X, 0)
            objects.Box.Right.To = boxPos + Vector2.new(boxSize.X, cornerSize)
            objects.Box.Right.Visible = true
            
            objects.Box.BottomLeft.From = boxPos + Vector2.new(0, boxSize.Y)
            objects.Box.BottomLeft.To = boxPos + Vector2.new(cornerSize, boxSize.Y)
            objects.Box.BottomLeft.Visible = true
            
            objects.Box.Bottom.From = boxPos + Vector2.new(0, boxSize.Y)
            objects.Box.Bottom.To = boxPos + Vector2.new(0, boxSize.Y - cornerSize)
            objects.Box.Bottom.Visible = true
            
            objects.Box.BottomRight.From = boxPos + Vector2.new(boxSize.X, boxSize.Y)
            objects.Box.BottomRight.To = boxPos + Vector2.new(boxSize.X - cornerSize, boxSize.Y)
            objects.Box.BottomRight.Visible = true
            
            objects.Box.Top.From = boxPos + Vector2.new(boxSize.X, boxSize.Y)
            objects.Box.Top.To = boxPos + Vector2.new(boxSize.X, boxSize.Y - cornerSize)
            objects.Box.Top.Visible = true
        end
        
        for _, line in pairs(objects.Box) do
            if line.Visible then
                line.Color = color
                line.Thickness = Config.BoxThickness
            end
        end
    else
        for _, line in pairs(objects.Box) do line.Visible = false end
    end
    
    -- Name ESP
    if Config.NameESP then
        objects.Name.Text = player.Name
        objects.Name.Position = Vector2.new(pos.X, top.Y - 20)
        objects.Name.Color = color
        objects.Name.Size = Config.TextSize
        objects.Name.Visible = true
    else
        objects.Name.Visible = false
    end
    
    -- Tracer ESP
    if Config.TracerESP then
        objects.Tracer.From = GetTracerOrigin()
        objects.Tracer.To = Vector2.new(pos.X, pos.Y)
        objects.Tracer.Color = color
        objects.Tracer.Visible = true
    else
        objects.Tracer.Visible = false
    end
    
    -- Health ESP
    if Config.HealthESP then
        local health = humanoid.Health
        local maxHealth = humanoid.MaxHealth
        local healthPercent = math.max(0, math.min(1, health / maxHealth))
        
        local barHeight = screenHeight * 0.8
        local barWidth = 4
        local barPos = Vector2.new(boxPos.X - barWidth - 2, boxPos.Y + (screenHeight - barHeight)/2)
        
        objects.HealthBar.Outline.Size = Vector2.new(barWidth, barHeight)
        objects.HealthBar.Outline.Position = barPos
        objects.HealthBar.Outline.Visible = true
        
        objects.HealthBar.Fill.Size = Vector2.new(barWidth - 2, barHeight * healthPercent)
        objects.HealthBar.Fill.Position = Vector2.new(barPos.X + 1, barPos.Y + barHeight * (1 - healthPercent))
        objects.HealthBar.Fill.Color = Color3.fromRGB(255 * (1 - healthPercent), 255 * healthPercent, 0)
        objects.HealthBar.Fill.Visible = true
        
        if Config.HealthStyle == "Text" or Config.HealthStyle == "Both" then
            objects.HealthBar.Text.Text = math.floor(health) .. "/" .. math.floor(maxHealth)
            objects.HealthBar.Text.Position = Vector2.new(boxPos.X + boxWidth/2, boxPos.Y - 5)
            objects.HealthBar.Text.Color = color
            objects.HealthBar.Text.Size = Config.TextSize - 2
            objects.HealthBar.Text.Visible = true
        else
            objects.HealthBar.Text.Visible = false
        end
    else
        objects.HealthBar.Outline.Visible = false
        objects.HealthBar.Fill.Visible = false
        objects.HealthBar.Text.Visible = false
    end
end

-- Update loop
RunService.RenderStepped:Connect(function()
    if Config.Enabled then
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                UpdateESP(player)
            end
        end
    end
end)

-- Player events
Players.PlayerAdded:Connect(CreateESP)
Players.PlayerRemoving:Connect(RemoveESP)

-- Initialize for existing players
for _, player in pairs(Players:GetPlayers()) do
    if player ~= LocalPlayer then
        CreateESP(player)
    end
end

-- Menu toggle
UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.Insert then
        Window:SetVisibility(not Window.Visible)
    end
end)

-- Select first tab
Window:SelectTab(1)

Fluent:Notify({
    Title = "WA ESP v1.0",
    Content = "Pure ESP loaded! Press Insert for menu.",
    Duration = 5
})
